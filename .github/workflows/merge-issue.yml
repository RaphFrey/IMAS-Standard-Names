on:
  issues:
    types: [labeled]

jobs:

  label-issue:
    uses: ./.github/workflows/label-issue.yml

  merge-issue:
    if: ${{ github.event.label.name == 'merge' }}
    runs-on: ubuntu-latest
    needs: label-issue

    steps:

      # - run: node submission.js

      # - run: yarn
      
      # - run: node ./update.js
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # - run: node ./generate-readme.js

      # - run: |
      #       git config user.email "github@stefanbuck.com"
      #       git config user.name "Stefan Buck"
      #       git add README.md data.json
      #       git diff-index --quiet HEAD || git commit -m "Add new list item"

      # - run: git push

      - name: Check labels 
        if: ${{ contains(needs.label-issue.outputs.update, 'Success') && contains(github.event.issue.labels.*.name, 'needswork') }}
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          ISSUE_URL: ${{ github.event.issue.html_url }}
        run: |
          gh issue edit $ISSUE_URL --remove-label "merge"
          gh issue comment $ISSUE_URL --body "Remove `needswork` label to merge."

      - name: Close issue
        if: ${{ contains(needs.label-issue.outputs.update, 'Success')  && !contains(github.event.issue.labels.*.name, 'needswork') }}
        uses: peter-evans/close-issue@v1
        with:
          comment: Merged **${{ needs.label-issue.outputs.standard-name }}** with standardnames.yml.
